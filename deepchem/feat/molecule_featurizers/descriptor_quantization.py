import numpy as np

BUCKETS = {
    "qed": [[0.0168, 0.412], [0.412, 0.54], [0.54, 0.659], [0.659, 0.947]],
    "MolWt": [
        [150.14, 381.432],
        [381.432, 422.449],
        [422.449, 465.579],
        [465.579, 947.065],
    ],
    "NumValenceElectrons": [
        [41.999, 142.0],
        [142.0, 160.0],
        [160.0, 176.0],
        [176.0, 372.0],
    ],
    "NumRadicalElectrons": [[-0.001, 1.0]],
    "MaxPartialCharge": [
        [-0.0543, 0.243],
        [0.243, 0.27],
        [0.27, 0.319],
        [0.319, 0.737],
    ],
    "MinPartialCharge": [
        [-1.001, -0.478],
        [-0.478, -0.381],
        [-0.381, -0.368],
        [-0.368, -0.0533],
    ],
    "MaxAbsPartialCharge": [
        [0.0523, 0.368],
        [0.368, 0.387],
        [0.387, 0.479],
        [0.479, 1.0],
    ],
    "MinAbsPartialCharge": [
        [1.0000000000000026e-05, 0.243],
        [0.243, 0.269],
        [0.269, 0.319],
        [0.319, 0.597],
    ],
    "FpDensityMorgan1": [[0.264, 1.031], [1.031, 1.143], [1.143, 1.25], [1.25, 1.917]],
    "FpDensityMorgan2": [[0.416, 1.75], [1.75, 1.889], [1.889, 2.0], [2.0, 2.7]],
    "FpDensityMorgan3": [[0.457, 2.394], [2.394, 2.556], [2.556, 2.703], [2.703, 3.4]],
    "TPSA": [[-0.001, 76.82], [76.82, 109.14], [109.14, 134.41], [134.41, 444.78]],
    "FractionCSP3": [[-0.001, 0.25], [0.25, 0.368], [0.368, 0.5], [0.5, 1.0]],
    "HeavyAtomCount": [[7.999, 27.0], [27.0, 30.0], [30.0, 33.0], [33.0, 68.0]],
    "NHOHCount": [[-0.001, 1.0], [1.0, 3.0], [3.0, 4.0], [4.0, 23.0]],
    "NOCount": [[-0.001, 6.0], [6.0, 8.0], [8.0, 10.0], [10.0, 28.0]],
    "NumAliphaticCarbocycles": [[-1, 0], [0, 1], [1, 2], [2, 8]],
    "NumAliphaticHeterocycles": [[-1, 0], [0, 1], [1, 2], [2, 8]],
    "NumAliphaticRings": [[-0.001, 1.0], [1.0, 2.0], [2.0, 3.0], [3, 10]],
    "NumAromaticCarbocycles": [[-0.001, 1.0], [1.0, 2.0], [2.0, 3.0], [3.0, 8.0]],
    "NumAromaticHeterocycles": [[-0.001, 1.0], [1.0, 2.0], [2.0, 3.0], [3.0, 7.0]],
    "NumAromaticRings": [[-0.001, 2.0], [2.0, 3.0], [3.0, 4.0], [4, 9]],
    "NumHAcceptors": [[-0.001, 5.0], [5.0, 6.0], [6.0, 7.0], [7.0, 26.0]],
    "NumHDonors": [[-0.001, 1.0], [1.0, 2.0], [2.0, 3.0], [3.0, 17.0]],
    "NumHeteroatoms": [[-0.001, 7.0], [7.0, 9.0], [9.0, 11.0], [11.0, 32.0]],
    "NumRotatableBonds": [[-0.001, 5.0], [5.0, 6.0], [6.0, 8.0], [8.0, 30.0]],
    "NumSaturatedCarbocycles": [[-0.001, 0.0], [0, 1], [1, 2], [2, 8]],
    "NumSaturatedHeterocycles": [[-0.001, 0.0], [0, 1], [1, 2], [2, 8]],
    "NumSaturatedRings": [[-0.001, 1.0], [1.0, 2.0], [2.0, 3.0], [3, 9]],
    "RingCount": [[-0.001, 2.0], [2.0, 3.0], [3, 4], [4.0, 13.0]],
    "MolLogP": [
        [-9.277999999999999, 0.348],
        [0.348, 2.329],
        [2.329, 4.04],
        [4.04, 15.094],
    ],
    "MolMR": [
        [16.296999999999997, 98.896],
        [98.896, 110.761],
        [110.761, 124.432],
        [124.432, 274.005],
    ],
}


def quantize(v, feature):
    bins = BUCKETS[feature]
    ohe = [0] * len(bins)
    for i, ibin in enumerate(bins):
        minv = -np.inf if i == 0 else ibin[0]
        maxv = np.inf if i == len(bins) - 1 else ibin[1]
        if minv < v <= maxv:
            ohe[i] = 1
            break
    return ohe
